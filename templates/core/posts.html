{% extends 'core/base.html' %}

{% load staticfiles %}

{% block content %}
<div class="container">
	<div class="toprow">
		<h2>{% if top %}Top{% else %}Recently Added{% endif %} {% if topic %}'{{ topic }}'{% endif %} Resources {% if contains %}on '{{ contains }}'{% endif %}</h2>
		
		{% if top %}
		<a id="filter-top" href="{% url 'posts:view_all' %}{% if topic %}?topic={{ topic }}&{% else %}?{% endif %}{% if contains %}contains={{ contains }}{% endif %}">/ show recently added resources {% if contains %}on '{{ contains }}'{% endif %}</a>
		{% else %}
		<a id="filter-top" href="{% if topic %}?topic={{ topic }}&{% else %}?{% endif %}top=true{% if contains %}&contains={{ contains }}{% endif %}">/ show top rated resources {% if contains %}on '{{ contains }}'{% endif %}</a>
		{% endif %}
		</h2>
		<input class="large" name="postsearch" type="text" placeholder="search" />		
	</div>

	<div class="posts">
		{% for post in posts %}
		<div class="post">
			{% if post.disallow_vote %}
			<div class="votes-contain voted" data-url="{% url 'posts:vote' %}" data-voted="true" data-object-id="{{ post.pk }}">			
			{% else %}
			<div class="votes-contain" data-url="{% url 'posts:vote' %}" data-object-id="{{ post.pk }}">			
			{% endif %}
				<i data-vote-direction="up" class="fa fa-chevron-up"></i>
				<span class="count">{{ post.vote_count }}</span>
				<i data-vote-direction="down" class="fa fa-chevron-down"></i>
			</div>

			<div class="title-contain">
				<h2><a href="{% url 'posts:view' slug=post.slug %}">{{ post.title }}</a></h2>
				<p class="super-light-font">{{ post.description|truncatechars:99 }}</p>
				<span class="timestamp super-light-font">Posted {{ post.created }}</span>
			</div>

			<div id="profilePopup{{ post.id }}" class="user-profile-tooltip">
				<img class="owner" src="{{ post.owner.profile_pic.url }}" />
				<p class="username">{{ post.owner.owner.username }}</p>
				<p class="points"><i class="fa fa-star"></i>{{ post.owner.points }}</p>
				<br />
				{% if post.owner.title %}			
				<p class="title super-light-font">{{ post.owner.title }}</p>
				{% endif %}
				<a class="btn btn-clear" href="{% url 'accounts:profile' username=post.owner.owner.username %}">view profile</a>
			</div>			

			<div class="owner-contain">
				<img data-target="#profilePopup{{ post.id }}" class="owner profile-hover-toggle" src="{{ post.owner.profile_pic.url }}" />
			</div>			

			<div class="post-info-contain super-light-font">
				<i class="fa fa-comments"></i><span class="comment-count">{{ post.comments.all.count }}</span>
			</div>
		</div>
		{% endfor %}

		{% if not posts or posts.count < 5 %}
		<p id="sorry" class="super-light-font">Looks like there haven't been many resources added for this topic. You can help! Click "add resource" in the top right corner to add a good resource you know of. Help build Wikivinci!</p>
		{% endif %}
	</div>
</div>
{% endblock content %}
{% extends 'core/base.html' %}

{% load staticfiles %}

{% block content %}
<div id="single-post" class="container">
	<div id="left-column">
		<div class="toprow">
			{% if post.disallow_vote %}
			<div class="votes-contain voted" data-voted="true" data-object-id="{{ post.pk }}" data-url="{% url 'comments:vote' %}">				
			{% else %}
			<div class="votes-contain" data-object-id="{{ post.pk }}" data-url="{% url 'posts:vote' %}">				
			{% endif %}
				<i data-vote-direction="up" class="fa fa-chevron-up"></i>
				<span class="count">{{ post.vote_count }}</span>
				<i data-vote-direction="down" class="fa fa-chevron-down"></i>
			</div>			
			
			<h2><a target="_blank" href="{{ post.url }}">{{ post.title }}</a></h2>
		</div>

		<p class="super-light-font post-descr">{{ post.description }}</p>

		<div id="comments">

			{% for comment in comments %}
			<div class="comment">
				<div class="comment-owner">
					<img src="{{ comment.owner.profile_pic.url }}" />
				</div>

				{% if comment.disallow_vote %}
				<div class="votes-contain voted" data-voted="true" data-object-id="{{ comment.pk }}" data-url="{% url 'comments:vote' %}">				
				{% else %}
				<div class="votes-contain" data-object-id="{{ comment.pk }}" data-url="{% url 'comments:vote' %}">
				{% endif %}
					<i data-vote-direction="up" class="fa fa-chevron-up"></i>
					<span class="count">{{ comment.vote_count }}</span>
					<i data-vote-direction="down" class="fa fa-chevron-down"></i>
				</div>
				
				<div class="content">
					<p>{{ comment.text }}</p>
					{% if comment.created < comment.updated %}
					<span class="super-light-font timestamp">Comment posted {{ comment.created }} by {{ comment.owner.owner.username }}. Last updated {{ comment.updated }} by {{ comment.last_updated_by.owner.username }}.</span>
					{% else %}
					<span class="super-light-font timestamp">Comment posted {{ comment.created }} by {{ comment.owner.owner.username }}.</span>					
					{% endif %}					
				</div>
			</div>
			{% endfor %}

			<form id="add-comment" method="POST" action="{% url 'comments:add' %}" data-post-id="{{ post.id }}">
				<p>Have something to say about this resource? Add a comment!</p>
				<textarea name="text"></textarea>
				<input type="submit" class="btn btn-success" value="Submit comment" />
			</form>					
		</div>		
	</div>

	<div id="right-column">
		<div id="post-info">
			<b>Good resource? Upvote it so others can find it!</b>
			<img id="owner" src="{{ post.owner.profile_pic.url }}" />
			<p id="timestamp" class="super-light-font">posted by {{ post.owner.owner.username }} on {{ post.created }}</p>

			{% if post.upvotes > 0 %}
			<div id="upvoters">
				<p id="title" class="super-light-font">upvoted by</p>
				{% for upvoter in post.upvoters.all %}
				<img id="owner" src="{{ upvoter.profile_pic.url }}" />
				{% endfor %}
			</div>
			{% endif %}
		</div>
	</div>
</div>
{% endblock content %}